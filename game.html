<!-- 
    TO DO
    *) better graphics - show where the flow starts
    *) Count moves differently (consecutively clicks on same point only count once)
    *) Time taken?
    *) Different shapes (triangles and hexagons)
-->

<html>
<head>
    <style>
        .moveInfo { position:absolute; left: 15px; top: 820px;}
    </style>
    <script src="graphics.js"></script>
    <script src="puzzle.js"></script>
</head>
<body>
    <canvas id="myCanvas" width="800" height="800" style="border:solid black 1px;"></canvas>
    <span class="moveInfo">Move count: <span id="moveCount">Not started</span></span>
    <script language="JavaScript">
        let canvas = document.getElementById('myCanvas'),
            canvasLeft = canvas.offsetLeft + canvas.clientLeft,
            canvasTop = canvas.offsetTop + canvas.clientTop,
            colCount = 4,
            rowCount = 5,
            moveCount = 0,
            graphics; 

        canvas.addEventListener('click', function (event) {
            let x = event.pageX - canvasLeft,
                y = event.pageY - canvasTop;

            let shape = graphics.getShapeAtPoint(x, y);

            if (shape != null) {
                shape.piece.interact();
                moveCount+= 1
                render();

                if (graphics.puzzle.isFinished()) {
                    setTimeout(congratulate, 500);
                }
            }
        }, false);

        newPuzzle();

        function congratulate() {
            alert('Well done! You finished in ' + moveCount + ' turns.');
            newPuzzle();
        }

        function newPuzzle(){ 
            moveCount = 0;
            let puzzle = new Puzzle(colCount, rowCount);

            graphics = new Graphics(canvas, puzzle);
            graphics.addPieces(puzzle.pieces);

            render(graphics);
        }

        function render() {
            document.getElementById('moveCount').innerHTML = moveCount;
            graphics.render();
        }
    </script>

</body>

</html>