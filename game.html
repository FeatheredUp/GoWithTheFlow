<!-- 
    TO DO
    *) Finish conditions
    *) Count moves differently (consecutively clicks on same point only count once)
    *) Time taken?
    *) Different shapes (triangles and hexagons)
-->

<html>
<head>
    <style>
        .moveInfo { position:absolute; left: 15px; top: 820px;}
    </style>
    <script src="graphics.js"></script>
    <script src="puzzle.js"></script>
</head>
<body>
    <canvas id="myCanvas" width="800" height="800"></canvas>
    <span class="moveInfo">Move count: <span id="moveCount">Not started</span></span>
    <script language="JavaScript">
        let canvas = document.getElementById('myCanvas'),
            canvasLeft = canvas.offsetLeft + canvas.clientLeft,
            canvasTop = canvas.offsetTop + canvas.clientTop,
            colCount = 4,
            rowCount = 7,
            moveCount = 0; 

        canvas.addEventListener('click', function (event) {
            let x = event.pageX - canvasLeft,
                y = event.pageY - canvasTop;

            let shape = graphics.getShapeAtPoint(x, y);

            if (shape != null) {
                shape.piece.interact();
                moveCount+= 1
                puzzle.calculateFlow();
                render();
            }
        }, false);


        let puzzle = new Puzzle(colCount, rowCount);
        puzzle.mixUp();
        puzzle.calculateFlow();

        let graphics = new Graphics(canvas, colCount, rowCount);
        graphics.addPieces(puzzle.pieces);

        render();

        function render() {
            document.getElementById('moveCount').innerHTML = moveCount;
            graphics.render();
        }
    </script>

</body>

</html>